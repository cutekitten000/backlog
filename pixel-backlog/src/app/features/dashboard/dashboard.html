<!-- Diálogo para adicionar OU editar jogos -->
@if (isAddDialogOpen) {
  <!-- CORREÇÃO: Adicionamos a ligação [gameToEdit] -->
  <app-add-game-dialog [gameToEdit]="gameBeingEdited" (close)="closeDialog()"></app-add-game-dialog>
}

<!-- NOVO: Diálogo para ver detalhes e DLCs -->
@if (isDetailsOpen && selectedGameForDetails) {
  <app-game-details-dialog [game]="selectedGameForDetails" (close)="closeDetailsDialog()"></app-game-details-dialog>
}

<div class="sanctuary-container">
  <header class="sanctuary-header">
    <h1 class="title">Pixel Backlog</h1>
    <button type="button" class="rune-btn" (click)="authService.logout()">
      Partir
    </button>
  </header>

  <main>
    <section class="filters-container">
      @for (filter of filterOptions; track filter) {
        <button
          type="button"
          class="rune-btn"
          [class.is-active]="backlogService.filter() === filter"
          (click)="backlogService.filter.set(filter)">
          <i class="material-symbols-outlined rune-icon">{{ getIconForStatus(filter) }}</i>
          <span>{{ filter }}</span>
        </button>
      }
    </section>

    <section class="game-list-section">
      <div class="add-button-container">
        <button type="button" class="rune-btn" (click)="openAddDialog()">
          + Adicionar Jogo
        </button>
      </div>

      <div class="game-list" [@listAnimation]="backlogService.filteredGames().length">
        @for (game of backlogService.filteredGames(); track game.id) {
          <app-game-card
            [game]="game"
            (delete)="onDeleteGame($event)"
            (edit)="openEditDialog(game)"
            (details)="openDetailsDialog(game)">
          </app-game-card>
        } @empty {
          <div class="empty-state">
            <p>O Milagre não respondeu.</p>
            <p>Adicione um penitente para começar a sua jornada.</p>
          </div>
        }
      </div>
    </section>
  </main>
</div>